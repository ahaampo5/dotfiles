#!/usr/bin/env zsh
# ë””ìŠ¤í¬ ì •ë³´ í™•ì¸ í•¨ìˆ˜

function check_disk() {
    echo "ğŸ’¿ ë””ìŠ¤í¬ ì •ë³´"
    echo "=================="
    
    if [[ "$(uname)" == "Darwin" ]]; then
        # macOSì—ì„œ ë””ìŠ¤í¬ ì •ë³´ í™•ì¸
        echo "ë§ˆìš´íŠ¸ëœ ë””ìŠ¤í¬:"
        df -h | grep -E "^/dev/" | while read line; do
            local device=$(echo "$line" | awk '{print $1}')
            local size=$(echo "$line" | awk '{print $2}')
            local used=$(echo "$line" | awk '{print $3}')
            local available=$(echo "$line" | awk '{print $4}')
            local percent=$(echo "$line" | awk '{print $5}')
            local mount=$(echo "$line" | awk '{print $9}')
            
            echo "  ğŸ“± ${device}"
            echo "     í¬ê¸°: ${size} | ì‚¬ìš©: ${used} | ì—¬ìœ : ${available} | ì‚¬ìš©ë¥ : ${percent}"
            echo "     ë§ˆìš´íŠ¸: ${mount}"
            echo ""
        done
        
        # ë””ìŠ¤í¬ I/O ì •ë³´
        echo "ë””ìŠ¤í¬ I/O í†µê³„:"
        if command -v iostat >/dev/null 2>&1; then
            iostat -d 1 2 | tail -n +3 | grep -v "^$" | tail -1 | while read line; do
                local device=$(echo "$line" | awk '{print $1}')
                local read_mb=$(echo "$line" | awk '{print $2}')
                local write_mb=$(echo "$line" | awk '{print $3}')
                echo "  ${device}: ì½ê¸° ${read_mb} MB/s, ì“°ê¸° ${write_mb} MB/s"
            done
        fi
        
        # ë””ìŠ¤í¬ ì˜¨ë„ (smartctlì´ ì„¤ì¹˜ë˜ì–´ ìˆì„ ê²½ìš°)
        if command -v smartctl >/dev/null 2>&1; then
            echo ""
            echo "ë””ìŠ¤í¬ ì˜¨ë„:"
            diskutil list | grep "^/dev/disk" | awk '{print $1}' | while read disk; do
                local temp=$(smartctl -a "$disk" 2>/dev/null | grep "Temperature_Celsius" | awk '{print $10}')
                if [[ -n "$temp" ]]; then
                    echo "  ${disk}: ${temp}Â°C"
                fi
            done
        fi
        
        # SSD ìˆ˜ëª… ì •ë³´
        echo ""
        echo "SSD ìƒíƒœ:"
        system_profiler SPSerialATADataType 2>/dev/null | grep -A 10 "Solid State" | grep -E "(Medium Type|Available Spare)" | while read line; do
            echo "  $line"
        done
        
    else
        # Linux/Unix ì‹œìŠ¤í…œ
        echo "ë§ˆìš´íŠ¸ëœ íŒŒì¼ì‹œìŠ¤í…œ:"
        df -h | grep -vE "^Filesystem|tmpfs|cdrom" | awk '{print $1 " " $2 " " $3 " " $4 " " $5 " " $6}'
        
        # ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ ìƒìœ„ 10ê°œ ë””ë ‰í† ë¦¬
        echo ""
        echo "í˜„ì¬ ë””ë ‰í† ë¦¬ í•˜ìœ„ ìš©ëŸ‰ ìƒìœ„ 10ê°œ:"
        du -h --max-depth=1 2>/dev/null | sort -hr | head -10
    fi
    
    echo ""
}

# í•¨ìˆ˜ ì‹¤í–‰ (ìŠ¤í¬ë¦½íŠ¸ë¡œ ì§ì ‘ ì‹¤í–‰ë  ë•Œ)
if [[ "${BASH_SOURCE[0]}" == "${0}" ]] || [[ "${(%):-%x}" == "${0}" ]]; then
    check_disk "$@"
fi
