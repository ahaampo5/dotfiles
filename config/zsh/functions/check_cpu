#!/usr/bin/env zsh
# CPU ì •ë³´ í™•ì¸ í•¨ìˆ˜

function check_cpu() {
    echo "ğŸ”¥ CPU ì •ë³´"
    echo "================"
    
    if [[ "$(uname)" == "Darwin" ]]; then
        # macOSì—ì„œ CPU ì •ë³´ í™•ì¸
        local cpu_brand=$(sysctl -n machdep.cpu.brand_string 2>/dev/null)
        local cpu_cores=$(sysctl -n hw.ncpu 2>/dev/null)
        local cpu_threads=$(sysctl -n hw.logicalcpu 2>/dev/null)
        local cpu_freq=$(sysctl -n hw.cpufrequency_max 2>/dev/null)
        
        echo "CPU: ${cpu_brand:-"ì •ë³´ ì—†ìŒ"}"
        echo "ë¬¼ë¦¬ ì½”ì–´: ${cpu_cores:-"ì •ë³´ ì—†ìŒ"}"
        echo "ë…¼ë¦¬ ì½”ì–´: ${cpu_threads:-"ì •ë³´ ì—†ìŒ"}"
        
        # CPU ì£¼íŒŒìˆ˜ (Hz -> GHz ë³€í™˜)
        if [[ -n "$cpu_freq" ]]; then
            local freq_ghz=$(echo "scale=2; $cpu_freq / 1000000000" | bc 2>/dev/null)
            echo "ìµœëŒ€ ì£¼íŒŒìˆ˜: ${freq_ghz} GHz"
        fi
        
        # CPU ì‚¬ìš©ë¥  (top ëª…ë ¹ì–´ ì‚¬ìš©)
        local cpu_usage=$(top -l 1 -n 0 | grep "CPU usage" | awk '{print $3}' | sed 's/%//')
        echo "í˜„ì¬ ì‚¬ìš©ë¥ : ${cpu_usage}%"
        
        # ì˜¨ë„ ì •ë³´ (powermetrics ì‚¬ìš©, ê¶Œí•œì´ ìˆì„ ê²½ìš°)
        if command -v powermetrics >/dev/null 2>&1; then
            local temp=$(sudo powermetrics -n 1 -s cpu_power 2>/dev/null | grep "CPU die temperature" | awk '{print $4}' | head -1)
            if [[ -n "$temp" ]]; then
                echo "CPU ì˜¨ë„: ${temp}Â°C"
            fi
        fi
        
    else
        # Linux/Unix ì‹œìŠ¤í…œ
        if [[ -f /proc/cpuinfo ]]; then
            local cpu_model=$(grep "model name" /proc/cpuinfo | head -1 | cut -d: -f2 | sed 's/^ *//')
            local cpu_cores=$(grep -c "^processor" /proc/cpuinfo)
            echo "CPU: ${cpu_model}"
            echo "ì½”ì–´ ìˆ˜: ${cpu_cores}"
        fi
    fi
    
    echo ""
}

# í•¨ìˆ˜ ì‹¤í–‰ (ìŠ¤í¬ë¦½íŠ¸ë¡œ ì§ì ‘ ì‹¤í–‰ë  ë•Œ)
if [[ "${BASH_SOURCE[0]}" == "${0}" ]] || [[ "${(%):-%x}" == "${0}" ]]; then
    check_cpu "$@"
fi
